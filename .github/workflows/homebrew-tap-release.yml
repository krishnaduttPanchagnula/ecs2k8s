name: Update Homebrew Tap

on:
  release:
    types: [published]

jobs:
  update-homebrew-tap:
    runs-on: ubuntu-latest
    steps:
      - name: Trigger Homebrew tap update
        env:
          TAP_GITHUB_TOKEN: ${{ secrets.HOMEBREW_TAP_TOKEN }}
        run: |
          # Get the release version and download URLs
          VERSION=${{ github.event.release.tag_name }}
          VERSION=${VERSION#v}  # Remove 'v' prefix if present

          # Trigger repository dispatch to homebrew-tap repo
          curl -X POST \
            -H "Accept: application/vnd.github.v3+json" \
            -H "Authorization: token $TAP_GITHUB_TOKEN" \
            https://api.github.com/repos/krishnaduttPanchagnula/homebrew-ecs2k8s/dispatches \
            -d "{\"event_type\":\"release\",\"client_payload\":{\"version\":\"$VERSION\",\"release_url\":\"${{ github.event.release.html_url }}\"}}"
